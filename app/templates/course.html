{% extends "base.html" %}

{% block content %}

    <b>{{ course.name }}</b>
    <hr />

    <a href={{url_for('gr')}} style="text-decoration:none"> <div name="warn-gr" class="alert alert-warning p-2 small" role="alert" display="none">
      
      העמוד הנוכחי מכיל קישורים למערכת ה-GR (טכניון). כדי שהקישורים יעבדו, יש 
           להגדיר טוקן עדכני
       מדי שעתיים. לחצו כאן כדי לעשות זאת.
      
    </div></a>
    <div class="overflow-auto">
    <form class="d-flex" method="post" >
    
    <table class="table w-auto col-auto">
        
        <thead>
            <tr class="align-middle">
            <td class="text-center">מעקב
              <label for="happy" class="float-start" style="font-size:10px; margin-top:8px">0%</label>
                <label for="" class="float-end" style="font-size:10px; margin-top:8px">100%</label>
            </td>
            <td class="text-center" colspan="2"></td>
            <td class="text-center">יוצרים</td>
            <td>
                    <select name="subject" class="selectpicker" multiple data-actions-box="true" data-style="" data-style-base="form-control" data-none-results-text="אין תוצאות עבור {0}" data-live-search="true" data-width="200px" data-none-selected-text="בחירת נושאים" data-select-all-text="בחר הכל" data-deselect-all-text="איפוס" data-selected-text-format="static">
                        {% for subject in subjects %}
                        <option id="subj-{{subject}}" {% if subject in filtered_subjects %} selected {% endif %}>{{ subject }}</option>
                        {% endfor %}
                      </select><button class="btn btn-outline-success" type="submit">סינון</button>
            </td>
            <td>
                <div class="input-group">
                <input name="query" class="form-control" type="search" value="{% if current_search %}{{current_search}}{% else %}{%endif%}" placeholder="חיפוש בגוף הטקסט" aria-label="Search">
                <button class="btn btn-outline-success" type="submit">חיפוש</button>
                </div>
              </td>
        </tr></thead>
      {% for directory in resources.keys() %}
      <tr style="font-size:10px">
        <td colspan="6" style="padding-top:15px;">
          <b>{{directory}}</b>
        </td>
      </td>
      {% for existing_resource in resources[directory].iterrows() %}
      <tr {%if existing_resource[1].show == False %}style="display:none"{%endif%}>
          <td>
              {% if not current_user.is_authenticated %}<span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="לסימון, הירשמו למערכת">{%endif%}
                  
                  <input type="range" min="0" max="4" value="{{existing_resource[1].done or '0'}}" style="width:100px" class="form-range" onChange="this.form.submit()" name="checkbox-{{existing_resource[1].resource_id}}"{% if not current_user.is_authenticated %}disabled {%endif%}>
                  </br>
                  {% if not current_user.is_authenticated %}</span>{%endif%}
          </td>
          <td><a class="text-decoration-none" target="_blank" href="{{ existing_resource[1].link }}">{{ existing_resource[1].description }}</a></td>
          <td><a class="text-decoration-none" href="{{ url_for('resource', resource_id=existing_resource[1].resource_id) }}">תגובות ופתרונות</a></td>
          <td>{{ existing_resource[1].creator }}</td>
          <td>
          {% for subj in existing_resource[1].subject %}
          {%if subj in filtered_subjects %}
          <button type="button" class="btn btn-primary" style="padding: 0.125rem 0.25rem;font-size: 0.75rem;border-radius: 0.3rem;" onClick="document.getElementById('subj-{{subj}}').selected = false; this.form.submit();">{{ subj }}</button>
          {% else %}
          <button type="button" class="btn btn-outline-primary" style="padding: 0.125rem 0.25rem;font-size: 0.75rem;border-radius: 0.3rem;" onClick="document.getElementById('subj-{{subj}}').selected = true; this.form.submit();">{{ subj }}</button>
          {% endif%}
              {% endfor %}
          </td>
          <td>{% if existing_resource[1].occurrences %}
              {{ existing_resource[1].occurrences }} התאמות {%endif%}</td>
          
      </tr>
      {% endfor %}
      {%endfor%}


    
</table>

</form>
{% if current_user.username == 'yaniv' %}
<hr />
<a href="{{ url_for('updatecourse', course_id=course.id) }}">ערוך קורס</a>

  {%endif%}

</div>
<script type="text/javascript">
    var links = document.getElementsByTagName('a');
    var d = new Date();
    for(let i = 0; i < links.length; i++)
  {
    if (links[i].href.includes('grades.cs.technion.ac.il/grades.cgi?')) {
        links[i].href = 'https://grades.cs.technion.ac.il/grades.cgi?' + localStorage.token + links[i].href.substr(links[i].href.indexOf('+'));
        document.getElementsByName("warn-gr")[0].display = "inline";
    }  
  }
</script>
{%endblock%}
